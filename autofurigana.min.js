autofurigana=function(t,n){const l=t=>/[\u3000-\u303F\u4E00-\u9FEF]/.test(t);let u=[],e=0,r="",f="";const o=()=>{u.push([f,r]),r="",f=""};for(let u=0;u<t.length;u++){if(f+=t[u],u+1==t.length){for(;e<n.length;)r+=n[e],e++;l(t[u])||(r=null),o();break}if(l(t[u])&&!l(t[u+1])){for(;t[u+1]!==n[e]||r.length<f.length;){if(void 0===n[e])return null;r+=n[e],e++}o()}else!l(t[u])&&l(t[u+1])&&(r=null,e+=f.length,o())}return u},autofurigana_brackets=function(t,n){let l=autofurigana(t,n),u="";for(let t=0;t<l.length;t++)null!==l[t][1]?(0!=t&&(u+=" "),u+=l[t][0]+"["+l[t][1]+"]"):u+=l[t][0];return u};